#! /bin/bash
#SBATCH -o ../out/%A.%x.%a.out # STDOUT
#SBATCH -e ../err/%A.%x.%a.err # STDERR
#SBATCH --mem-per-cpu=2G
#SBATCH -c 4
#SBATCH --partition=carter-compute
#SBATCH --time=14-00:00:00
#SBATCH --array=1-11%11

date
hostname

# snps=(rs72903445 rs12962856 rs12954742 rs10840420 rs7130140 rs6484291 rs10840419 rs6484302 rs61942233 rs4767037 rs6468360 rs62297985 rs62297987 rs12798157 rs75978721 rs72702928 rs860781 rs66499917 rs10736094 rs10736093 rs10882654 rs7904410 rs1935814 rs543672 rs7899286 rs12778814 rs11188434 rs12773566 rs526928 rs9888002 rs17770811 rs28459155 rs7910961 rs12722497 rs10157497 rs11209339 rs73963107 rs1307490 rs1307487 rs11971828 rs245880 rs7794536 rs245904 rs245872 rs6950140 rs11126416 rs10165862 rs3813229 rs12620074 rs7599323 rs2567600 rs6712242 rs17424071 rs73949333 rs10083157 rs11111080 rs1073083 rs9927410 rs2693076 rs41271951 rs56058687 rs35782301 rs1053732 rs2305814 rs12124948 rs75358607 rs141935877 rs11204664 rs68144650 rs17599629 rs35591746 rs78681982 rs112175941 rs115298177 rs141292640 rs2055975 rs12740679 rs79054420 rs12429692 rs12018461 rs4466940 rs9579646 rs138107887 rs12311093 rs61942639 rs34584785 rs34903295 rs73191849 rs149453822 rs11068866 rs12318210 rs142257763 rs28665218 rs6913851 rs4708797 rs2278612 rs10422720 rs34542675 rs8182583 rs4804774 rs3760688 rs7409459 rs62126597 rs12981234 rs12984870 rs7419176 rs1797827 rs35342379 rs13261840 rs76265950 rs4785702 rs77733403 rs17232812 rs6500452 rs464586 rs66701606 rs7200366 rs67689854 rs190797336 rs26491 rs28081 rs27524 rs27039 rs28096 rs66468220 rs2216752 rs709668 rs151823 rs26504 rs35469836 rs6875109 rs26499 rs28093 rs34755 rs697976 rs10045403 rs76200405 rs1421911 rs10434710 rs79506587 rs1230362 rs151936 rs12655342 rs151949 rs17086426 rs80144245 rs12517853 rs26511 rs246109 rs998509 rs173491 rs13167972 rs4869315 rs28040 rs75550369 rs62376449 rs59898871 rs62377087 rs30333 rs113007670 rs27302 rs9314177 rs27303 rs114248710 rs10053056 rs112608939 rs2549779 rs10061688 rs112797517 rs80016765 rs115559931 rs27439 rs62364747 rs2059199 rs1021717 rs113180484 rs78740770 rs2927611 rs155051 rs72772063 rs27765 rs152006 rs191240619 rs155041 rs17400078 rs17086593 rs114632540 rs3889528 rs183928580 rs760462 rs760457 rs7282310 rs2838734 rs3128511 rs637232 rs748659 rs596002 rs679147 rs7940691 rs11227311 rs56252769 rs35841983 rs11227303 rs117980218 rs2448490 rs624273 rs7937415 rs10896005 rs603598 rs555853 rs77738625 rs180886350 rs12576996 rs144367702 rs2105608 rs78287937 rs509206 rs479018 rs77291001 rs630336 rs76812270 rs80043704 rs61893816 rs12146493 rs55838040 rs1193692 rs2302884 rs116884770 rs10896045 rs78472894 rs10750766 rs72932859 rs652665 rs7941126 rs117467277 rs1203747 rs74539421 rs139049504 rs7112951 rs12787843 rs1209552 rs2306364 rs10501396 rs75191846 rs117711707 rs4930351 rs72939122 rs117309574 rs754532 rs10896024 rs739390 rs79438914 rs8010496 rs7143445 rs72900574 rs2203108 rs6815724 rs38029 rs72772065 rs17531248 rs34281672 rs10097252 rs1531576 rs1478891 rs330924 rs75833282 rs542570 rs7833387 rs694553 rs67390008 rs4802859 rs8111423 rs57071021 rs5030878 rs11669019 rs2070746 rs111530129 rs12971652 rs7251137 rs2053928 rs28396517 rs1868943 rs10424231 rs8099845 rs12461764 rs12460836 rs35215887 rs7253355 rs11735330 rs72669971 rs146336885 rs62323831 rs2445617 rs2072448 rs10744135 rs11567780 rs143822941 rs1048785 rs12117276 rs1493615 rs186634 rs11121022 rs1048773 rs531485 rs228727 rs61772673 rs74509095 rs500508 rs34177663 rs190108634 rs28449871 rs58863259 rs2171193 rs10028517 rs6446989 rs111254362 rs6831602 rs10801699 rs6679817 rs12048533 rs12132894 rs12140288 rs61766110 rs10923094 rs1808137 rs12565209 rs12078247 rs12409123 rs12143684 rs61766155 rs7525985 rs61767086 rs72724747 rs61766107 rs6661184 rs71666203 rs4596856 rs61766120 rs59612934 rs142013830 rs77582594 rs149571223 rs12691517 rs17471766 rs139176458 rs59688329 rs1498914 rs6428661 rs12129980 rs142795750 rs59386245 rs150888292 rs12131735 rs61766153 rs7543887 rs61765932 rs114704581 rs2039627 rs112901436 rs6701673 rs17486993 rs7531037 rs6659829 rs2810878 rs35747272 rs115245369 rs3806338 rs17431653 rs12032636 rs76470252 rs113490655 rs61766109 rs2390491 rs566613 rs12044798 rs115448588 rs114083954 rs41288379 rs147987935 rs6428638 rs17432369 rs17099902 rs151324113 rs60416282 rs6687618 rs72718589 rs11801905 rs56206863 rs77678542 rs145757249 rs114836593 rs12032672 rs11590984 rs11797 rs9817960 rs2267844 rs4858819 rs3135941 rs1264191 rs9844505 rs11130187 rs9812977 rs990211 rs73074378 rs183938645 rs112890859 rs4625 rs116503914 rs388483 rs1568691 rs2255532 rs28759711 rs73077200 rs6442126 rs149130226 rs76060013 rs6799186 rs80313406 rs11130158 rs2655060 rs34290943 rs11917071 rs9520845 rs7983661 rs7984090 rs858275 rs4719731 rs1964536 rs2927610 rs2549781 rs62377827 rs709669 rs2617442 rs6868625 rs2927619 rs3733904 rs62376388 rs30187 rs27619 rs72777604 rs2927614 rs144225384 rs462470 rs31019 rs56414182 rs12516308 rs72772074 rs76241969 rs114110091 rs155046 rs27041 rs17087082 rs114928905 rs1862182 rs11739478 rs17476752 rs17086512 rs30377 rs72773919 rs151940 rs79155073 rs75755560 rs2927613 rs26505 rs2303138 rs78824072 rs72775860 rs185972411 rs221970 rs2112179 rs76738463 rs62376415 rs188219168 rs113509235 rs79046296 rs155053 rs9918162 rs151830 rs111240662 rs62376450 rs28041 rs27639 rs78375313 rs185475636 rs27033 rs31018 rs3849748 rs6862521 rs10038030 rs4869306 rs78432477 rs111375116 rs113350557 rs80175638 rs144865827 rs78757066 rs55751508 rs78479094 rs13154053 rs31020 rs375920648 rs72775875 rs116764930 rs2548223 rs78499126 rs74555722 rs112824186 rs62377085 rs72770202 rs10075469 rs12513660 rs74929776 rs10515255 rs80159277 rs35959356 rs150725010 rs111370908 rs147209075 rs11741755 rs62365662 rs156015 rs152017 rs17087294 rs78971950 rs147414420 rs116290389 rs155057 rs114507131 rs7702304 rs140145574 rs114055671 rs138595016 rs10071657 rs27689 rs2350292 rs181378104 rs10055532 rs421173 rs17473246 rs56039602 rs150902001 rs72777626 rs6865929 rs141459858 rs3853203 rs72656694 rs4869299 rs155047 rs6896567 rs4869134 rs10063542 rs6230 rs6556949 rs1812695 rs56227820 rs72772047 rs113991850 rs115059230 rs17087080 rs113435652 rs76103479 rs4620041 rs79812383 rs3844506 rs72772011 rs111489916 rs6863597 rs27852 rs113323712 rs291806 rs11744768 rs150911112 rs150009959 rs34453544 rs145799781 rs26516 rs143795124 rs73273531 rs146029973 rs72656693 rs3866382 rs72772045 rs111771034 rs2677001 rs10487932 rs13225265 rs1063984 rs10753508 rs55852916 rs7556000 rs7515397 rs735025 rs78695089 rs12140547 rs17808267 rs4102739 rs11053726 rs72728480 rs77860219 rs10919544 rs10429882 rs6687275 rs9427403 rs4326638 rs72717040 rs72700091 rs74127049 rs9427390 rs67775399 rs6678315 rs7531561 rs35276103 rs11582349 rs4657040 rs199725261 rs755339 rs12120358 rs74387071 rs6427596 rs6671847 rs12756398 rs12118043 rs56842856 rs6795690 rs117198013 rs12334656 rs78206495 rs12523750 rs4646834 rs77818310 rs2744544 rs9467220 rs1054899 rs836820 rs32995 rs408626 rs1650690 rs112325102 rs33003 rs11741562 rs249209 rs555470 rs26781 rs13164793 rs35054829 rs1823024 rs2405867 rs35878018 rs249011 rs6861026 rs7737445 rs10942933 rs6882726 rs26910 rs28455764 rs17664442 rs11949801 rs16878218 rs114447579 rs12652038 rs6151782 rs13160125 rs434130 rs2434331 rs78621558 rs701394 rs74470571 rs1990858 rs11738950 rs249000 rs6897314 rs10069319 rs249633 rs7710907 rs79874572 rs35486429 rs149649783 rs171594 rs569262 rs74636337 rs1677631 rs507826 rs1592878 rs35548549 rs518171 rs144371909 rs7703252 rs6864609 rs249226 rs34997 rs62365916 rs6151598 rs13183802 rs4704666 rs6884102 rs10942923 rs62366861 rs503367 rs6878778 rs10075299 rs11750489 rs144404498 rs444937 rs2883061 rs78116634 rs4478300 rs26904 rs114914978 rs35496306 rs13062 rs5744258 rs40076 rs8043623 rs546055 rs11188 rs531805 rs3760109 rs35631 rs373507 rs35030877 rs145544315 rs780163 rs12926135 rs141277250 rs147434456 rs72776116 rs17806253 rs189355119 rs56305136 rs4968025 rs152451 rs8058450 rs67988001 rs4761234 rs317678 rs622656 rs11177603 rs10878976 rs2603079 rs478863 rs10878982 rs548240 rs60360671 rs61929063 rs11177576 rs75737671 rs74655189 rs315145 rs17813281 rs73145932 rs73335734 rs113800324 rs7251234 rs35970457 rs79955662 rs11084094 rs7251908 rs11666027 rs12460111 rs12462938 rs35782908 rs2864908 rs11665668 rs113861918 rs138816179 rs67295569 rs61802301 rs17411858 rs35139848 rs55971447 rs10774671 rs1293751 rs7961128 rs10850101 rs1557865 rs1293769 rs10850125 rs11513733 rs6489885 rs2003480 rs11613438 rs55676265 rs1293770 rs1316424 rs7968145 rs41560714 rs9260086 rs1655914 rs2077176 rs9380306 rs9272546 rs521539 rs3134996 rs2858327 rs1466410 rs3819290 rs707908 rs113071675 rs13214113 rs13193697 rs9260555 rs2844621 rs9472294 rs34843907 rs1129735 rs3135344 rs2693080 rs9469008 rs28366133 rs2523572 rs9267168 rs4388309 rs115427390 rs2894221 rs2905725 rs3130924 rs13208359 rs2230954 rs2844806 rs72927799 rs9273242 rs1573649 rs34865969 rs2143461 rs6912991 rs1736919 rs1610741 rs1131500 rs7762909 rs74705176 rs3135001 rs9274514 rs17612852 rs9274656 rs9272309 rs3129895 rs9271191 rs9275243 rs2395516 rs28732213 rs3104391 rs78459872 rs9271661 rs9270656 rs9270588 rs9491252 rs9357006 rs9379860 rs12213919 rs4148876 rs2621321 rs75882879 rs9276909 rs12179134 rs9264663 rs2040748 rs2395471 rs35881960 rs351855 rs4553808 rs11571316 rs11571317 rs3087243 rs5742909 rs231775 rs10954213 rs2280964 rs2157062 rs11746140 rs698944 rs2701005 rs17169789 rs10828576 rs11995613 rs16841148 rs41333046 rs10986105 rs2381412 rs1523328 rs1385195 rs41387649 rs17469935 rs1997140 rs137907 rs4594204 rs62547244 rs13347268 rs4764223 rs3904452 rs6861852 rs2648881 rs1571777 rs12803687 rs17368157 rs10203271 rs16991676 rs1414646 rs17116606 rs76224288 rs3110565 rs11984071 rs73016119 rs16971480 rs1152115 rs12073292 rs796279 rs9567930 rs7733544 rs2844434 rs6929614 rs11892516 rs1704829 rs12996364 rs9308067 rs12063638 rs74767767 rs17017432 rs17028564 rs3211892 rs7994979 rs1546266 rs11860439 rs12428566 rs10221202 rs147837458 rs36019630 rs16932237 rs681666 rs12290276 rs6887916 rs1018926 rs4819959 rs3366 rs3903072 rs429358 rs7412 rs28731494 rs11568821 rs2227981 rs7421861 rs10204525 rs4143815 rs2297136 rs822336 rs822337 rs2282055 rs2890658 rs10815225 rs2890657 rs822338 rs17718883 rs822339 rs1411262 rs2111485 rs35356925 rs9271300 rs3129758 rs2097431 rs9271325 rs9271701 rs9268199 rs9272226 rs9273500 rs7382085 rs2308891 rs3117181 rs6926894 rs9267551 rs9271367 rs9268234 rs9272545 rs9276189 rs3828794 rs9267950 rs13208697 rs3135365 rs1049053 rs3096697 rs3844313 rs12191360 rs3132453 rs4532479 rs7754768 rs3104409 rs28383263 rs6927022 rs9274500 rs2894257 rs3129780 rs3021304 rs6925893 rs422951 rs130079 rs28383322 rs2647004 rs9267898 rs9275924 rs1043618 rs693797 rs144039739 rs12939291 rs71510648 rs1890370 rs1920021 rs12775522 rs670645 rs16889186 rs2241048 rs2895332 rs17807076)
# snps=(rs28459155 rs6896567 rs9271701 rs2308891 rs6926894 rs3828794 rs4532479 rs4532479 rs28383263)
snps=(rs9270656 rs9491252)
snp=${snps[$SLURM_ARRAY_TASK_ID-1]}

# GENO=/cellar/users/mpagadal/projects/germline-immune3/data/ukbb/time-snp/dosage/UKBB_time_subset
# GENO=/cellar/users/mpagadal/projects/germline-immune3/data/ukbb/time-snp/dosage-multi/UKBB_time_subset_biallelic
GENO=/cellar/users/mpagadal/projects/germline-immune/data/ukbb/drb5/UKBB_DRB5_subset
# extract_dir=/cellar/users/mpagadal/projects/germline-immune3/data/ukbb/time-snp/extract
extract_dir=/cellar/users/mpagadal/projects/germline-immune/data/ukbb/drb5/extract
# OUT=/cellar/users/mpagadal/projects/germline-immune3/data/ukbb/time-snp/results
OUT=/cellar/users/mpagadal/projects/germline-immune/data/ukbb/drb5/results

cd $extract_dir
echo $snp > $snp.txt

plink --bfile $GENO --extract $snp.txt --make-bed --out $snp

rm $snp.txt

# Run PLATO
cd $OUT

GENO=$extract_dir/$snp
pheno=/cellar/users/mpagadal/data/ukbb/plato_input/immune_cancer_lev1_pheno.txt
COV1=AGE,SEX,PC1,PC2
COV2=PC3,PC4,PC5,PC6
COV3=PC7,PC8
COV4=PC9,PC10

plato --logfile $snp.log load-data --bfile $GENO load-trait --file $pheno regress-auto --odds-ratio --phewas --covariates $COV1 --covariates $COV2 --covariates $COV3 --covariates $COV4 --threads 4 --correction Bonferroni,FDR --output $snp.txt  

date